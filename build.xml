<?xml version="1.0"?>

<project name="ashkelon" default="jar">
   <description>project ashkelon</description>
   
   <property name="version" value="0.9" />

   <property name="db.type" value="mysql" />  <!-- current options are: mysql | oracle -->
   <property name="db.dir" value="db/${db.type}" />

   <property name="webapps.dir" value="c:\java\tomcat 41\webapps" />

   <target name="init">
      <mkdir dir="build/classes" />
   </target>
   
   <target name="clean">
      <delete dir="build" />
   </target>

   <path id="class.path">
      <pathelement location="${java.home}/lib/tools.jar" />
      <fileset dir="lib" includes="*.jar" />
      <fileset dir="${db.dir}" includes="*.jar" />
      <pathelement location="build/classes" />
   </path>

   <target name="compile" depends="init" description="compile">
      <javac debug="on" srcdir="src" destdir="build/classes" classpathref="class.path" />

      <copy todir="build/classes">
        <fileset dir="src">
          <exclude name="**/*.java" />
        </fileset>
      </copy>
      
      <copy todir="build/classes">
        <fileset dir="${db.dir}">
          <exclude name="**/*.jar" />
        </fileset>
      </copy>
   </target>

   <target name="jar" depends="compile" description="jar">
      <jar destfile="build/ashkelon.jar" basedir="build/classes" />
   </target>

   <target name="make_war" depends="jar" description="packages war file">
      <war destfile="build/ashkelon.war" webxml="etc/web.xml" basedir="htdocs">
         <lib dir="lib">
           <exclude name="servlet.jar" />
         </lib>
         <lib dir="${db.dir}" includes="*.jar" />
         <lib dir="build" includes="ashkelon.jar" />
      </war>
   </target>
   
   <target name="deploy_war" depends="make_war" description="deploy war file to servlet container">
     <copy file="build/ashkelon.war" todir="${webapps.dir}" overwrite="true" />
   </target>

   <target name="make_ear" depends="make_war" description="packages ear file">
      <ear destfile="build/ashkelon.ear" appxml="etc/application.xml" basedir="build" includes="ashkelon.war" />
   </target>
   
</project>
